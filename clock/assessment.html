<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clock</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            gap: 2rem;
            padding: 2rem;
        }

        .container {
            text-align: center;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 600px;
            height: 600px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }

        .logo {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        @media (max-width: 1200px) {
            body {
                flex-direction: column;
            }

            .logo-container {
                width: 400px;
                height: 400px;
            }
        }

        @media (max-width: 768px) {
            .logo-container {
                width: 300px;
                height: 300px;
            }
        }

        h1 {
            margin-bottom: 2rem;
            font-size: 2.5rem;
        }

        .timer-display {
            font-size: 8rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.2);
            padding: 2rem;
            border-radius: 15px;
            min-width: 600px;
            letter-spacing: 5px;
        }

        @media (max-width: 768px) {
            .timer-display {
                font-size: 4rem;
                min-width: auto;
                padding: 1rem;
                letter-spacing: 2px;
            }
        }

        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            align-items: center;
            justify-content: center;
        }

        .time-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .time-input-group label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .time-input-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .time-input-controls button {
            padding: 0.3rem 0.8rem;
            font-size: 1.2rem;
            background-color: rgba(255, 255, 255, 0.2);
            min-width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .time-input-controls button:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        input {
            padding: 0.5rem;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
            width: 80px;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.9);
        }

        button {
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #45a049;
        }

        button#reset {
            background-color: #f44336;
        }

        button#reset:hover {
            background-color: #da190b;
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .warning {
            color: #ff4444;
            animation: blink 1s infinite;
        }

        .set-time-display {
            font-size: 3rem;
            font-weight: bold;
            margin: 1rem 0;
            color: #4CAF50;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }

        .subject-title-container {
            margin-bottom: 1.5rem;
            width: 100%;
        }

        .subject-title-input {
            width: 100%;
            padding: 0.8rem 1rem;
            font-size: 1.5rem;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 5px;
            margin-bottom: 0.5rem;
        }

        .subject-title-display {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 1rem 0;
            color: white;
            text-align: center;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .fullscreen-mode .subject-title-display {
            font-size: 3rem;
            margin-bottom: 2rem;
        }

        @keyframes blink {
            50% {
                opacity: 0.5;
            }
        }

        .audio-controls {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            text-align: center;
        }

        .audio-controls button {
            background-color: #2196F3;
            margin: 0.5rem;
            min-width: 100px;
        }

        .audio-controls button:hover {
            background-color: #1976D2;
        }

        .audio-status {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            font-style: italic;
        }

        .end-exam-controls {
            display: none;
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            text-align: center;
        }

        .end-exam-controls.show {
            display: block;
        }

        .end-exam-controls button {
            background-color: #9C27B0;
            margin: 0.5rem;
            min-width: 100px;
        }

        .end-exam-controls button#pauseEndExam {
            background-color: #FF9800;
        }

        .end-exam-controls button#stopEndExam {
            background-color: #f44336;
        }

        .end-exam-controls button:hover {
            background-color: #7B1FA2;
        }

        .end-exam-controls button#pauseEndExam:hover {
            background-color: #F57C00;
        }

        .end-exam-controls button#stopEndExam:hover {
            background-color: #D32F2F;
        }

        .tts-container {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            text-align: center;
        }

        .tts-container.minimized .tts-content {
            display: none;
        }

        .tts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            cursor: pointer;
        }

        .tts-header h3 {
            margin: 0;
        }

        .tts-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            padding: 0.2rem 0.5rem;
            cursor: pointer;
            min-width: auto;
        }

        .tts-content {
            transition: height 0.3s ease;
        }

        .tts-container textarea {
            width: 100%;
            height: 100px;
            margin-bottom: 1rem;
            padding: 0.5rem;
            border-radius: 5px;
            border: none;
            resize: vertical;
            font-size: 1rem;
        }

        .tts-presets {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tts-presets button {
            background-color: #9C27B0;
        }

        .tts-presets button:hover {
            background-color: #7B1FA2;
        }

        .tts-presets select,
        .tts-presets input {
            padding: 0.5rem;
            border-radius: 5px;
            border: none;
            min-width: 150px;
        }

        .tts-setting-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Full screen mode styles */
        .fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-evenly;
            padding: 2rem;
        }

        .fullscreen-mode .logo-container {
            transform: scale(1);
            width: 400px;
            height: 400px;
            margin: 0;
        }

        .fullscreen-mode .timer-display {
            transform: scale(1);
            min-width: auto;
            font-size: 8rem;
            margin-top: 2rem;
        }

        .exit-fullscreen {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.3);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .exit-fullscreen:hover {
            background-color: rgba(0, 0, 0, 0.5);
        }

        .fullscreen-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
            z-index: 900;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .fullscreen-button:hover {
            background-color: #45a049;
        }

        .fullscreen-btn {
            padding: 1rem 2rem;
            font-size: 1.5rem;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 2rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s, transform 0.2s;
        }

        .fullscreen-btn:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }

        .fullscreen-btn:active {
            transform: scale(0.98);
        }

        .fullscreen-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .no-mobile-icon {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 500px;
            height: 500px;
            object-fit: contain;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.2);
        }

        @media (max-width: 1200px) {
            .no-mobile-icon {
                width: 300px;
                height: 300px;
            }
        }
    </style>
</head>

<body>
    <div class="logo-container">
        <img src="YCI LOGO.png" alt="YCI Logo" class="logo">
    </div>
    <div class="container">
        <h1>Assessment Clock</h1>
        <div class="subject-title-container">
            <input type="text" id="subjectTitle" class="subject-title-input" placeholder="Enter Assessment Subject"
                maxlength="100">
        </div>
        <div class="announcement" id="announcement">
            Attention! The assessment will begin shortly. Please ensure you have all necessary materials ready.
        </div>
        <div class="controls">
            <div class="time-input-group">
                <label>Hours</label>
                <div class="time-input-controls">
                    <button id="addHour">+</button>
                    <input type="number" id="hours" min="0" max="23" placeholder="HH">
                    <button id="subtractHour">âˆ’</button>
                </div>
            </div>
            <div class="time-input-group">
                <label>Minutes</label>
                <div class="time-input-controls">
                    <button id="addMinute">+</button>
                    <input type="number" id="minutes" min="0" max="59" placeholder="MM">
                    <button id="subtractMinute">âˆ’</button>
                </div>
            </div>
            <div class="time-input-group">
                <label>Seconds</label>
                <div class="time-input-controls">
                    <button id="addSecond">+</button>
                    <input type="number" id="seconds" min="0" max="59" placeholder="SS">
                    <button id="subtractSecond">âˆ’</button>
                </div>
            </div>
        </div>
        <div>
            <button id="setTimer">Set</button>
            <button id="start">Start Assessment</button>
            <button id="pause">Pause</button>
            <button id="reset">Reset</button>
        </div>
        <div class="set-time-display" id="setTimeDisplay" style="display: none;">Ready to start: 00:00:00</div>
        <div class="timer-display" id="timer">00:00:00</div>
        <div class="end-exam-controls" id="endExamControls">
            <h3>End of Assessment Announcement</h3>
            <div>
                <button id="playEndExam">Play</button>
                <button id="pauseEndExam">Pause</button>
                <button id="stopEndExam">Stop</button>
            </div>
            <div id="endExamStatus" class="audio-status"></div>
        </div>
        <div class="tts-container" id="ttsContainer">
            <div class="tts-header" id="ttsHeader">
                <h3>Assessment Rules</h3>
                <button class="tts-toggle" id="ttsToggle">âˆ’</button>
            </div>
            <div class="tts-content" id="ttsContent">
                <textarea id="ttsText" placeholder="Enter Assessment rules to be read aloud...">You are here to take:
                    Name of assessment: MATHEMATICS;
                    Syllabus code: 0580;
                    
                    Do not open the question paper until I instruct you to do so. You are now under exam conditions and must follow the rules detailed on the â€˜Notice to Candidatesâ€™ posters you can see in the room. You must not communicate with, ask for help from, or give help to any other candidate in the exam room. If you have a question at any time you must raise your hand and wait until an invigilator comes to you. Invigilators cannot answer any questions about the content of the question paper.
 
                    You are not allowed to have any unauthorised items in the exam room. If you have any unauthorised items, including mobile phones or any kind of electronic device you must hand them in now. If you do not hand them in your results may be cancelled.

                    No communication devices should be brought into the venue but if this is unavoidable, you must turn them off (including the alarm function) and put them under the chair in a position clearly visible to the invigilators.  If an electronic or communication device (e.g. PDA, mobile phones, tablets, MP3 players, electronic dictionaries, databank watches, smartwatches, Bluetooth headsets, pagers, etc.), is found in your pocket or on your body, you will be disqualified for the paper being examined.  If the electronic or communication device placed under the chair is found switched on or sounded during the Assessment, you may receive mark penalties.  Please note that the Campus cannot be held responsible for the security of these items in the Assessment venue.  Such devices must not be taken away should you go to lavatory during the Assessment.  However, you may request the invigilator to keep them temporarily. 
                    
                    You must put all your personal belongings including all electronic or communication devices (For example PDA, mobile phones, tablets, MP3 players, electronic dictionary, data bank watches, smartwatches, Bluetooth headsets, pagers, etc) in small bags that can be properly closed with a zip or buckle.  All the bags, books including electronic or communication devices and all unauthorized materials must be placed under the chair in a position clearly visible to the invigilator.  Check to ensure you do not have in your possession, or on your desk, any material relating to the Assessment.  If you are subsequently found to be in possession of such materials you will be considered to be cheating. You may not leave the venue during the first 30 minutes and during the final 15 minutes of the Assessment.

                    If during the Assessment you are suspected of cheating, the front cover of your answer book will be signed by the Invigilator to indicate that suspected cheating occurred.  Any unauthorised material will be taken from you and you will subsequently be required to present yourself to a Disciplinary Hearing. 

                    Place your Student ID card or Hong Kong ID card on the top right corner of the desk so that we can check them.

                    Do not turn the page of the question paper until you are told to do so. 

                    You must not communicate with any other student, nor do anything to cause a distraction.  Any misconduct will be reported and action taken. 

                    Eating and drinking is not allowed in the venue.  If you need to drink water (to accompany medication for example) or have any other urgent needs, raise your hand to attract an Invigilator's attention. 

                    You may not leave the venue during the first 30 minutes and during the final 15 minutes of the Assessment. 

                    We will announce the time remaining at the 30 minutes, 15 minutes and 5 minutes before the end of the Assessment. 

                    You are now under Assessment conditions.  Please do not write anything until you are told to do so. 

                    Please remain seated quietly.

                    

                    
                


                </textarea>

                <div class="tts-settings">
                    <div class="tts-setting-group">
                        <label for="ttsVoice">Voice:</label>
                        <span>Microsoft Andrew Online (Natural) - English (United States)</span>
                        <select id="ttsVoice"></select>
                    </div>
                    <div class="tts-setting-group">
                        <label for="ttsRate">Rate:</label>
                        <input type="range" id="ttsRate" min="0.5" max="2" step="0.1" value="1">
                        <span id="ttsRateValue">1.0</span>
                    </div>
                    <div class="tts-setting-group">
                        <label for="ttsPitch">Pitch:</label>
                        <input type="range" id="ttsPitch" min="0.5" max="2" step="0.1" value="1">
                        <span id="ttsPitchValue">1.0</span>
                    </div>
                </div>
                <div class="tts-presets">
                    <input type="text" id="presetName" placeholder="Preset Name">
                    <button id="savePreset">Save Preset</button>
                    <select id="presetSelect">
                        <option value="">-- Select Preset --</option>
                    </select>
                    <button id="loadPreset">Load</button>
                    <button id="deletePreset">Delete</button>
                </div>
            </div>
            <div class="tts-controls">
                <button id="playTts">Speak</button>
                <button id="pauseTts">Pause</button>
                <button id="resumeTts">Resume</button>
                <button id="stopTts">Stop</button>
            </div>
            <div id="ttsStatus" class="tts-status"></div>
        </div>
    </div>
    <audio id="endExamAudio">
        <source src="End of examination.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <button id="fullscreenButton" class="fullscreen-button" title="Enter full screen mode">
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3">
            </path>
        </svg>
        <span style="margin-left: 5px;">Full</span>
    </button>
    <script>
        let timeLeft;
        let timerId = null;
        let isRunning = false;
        let isPlayingEndExam = false;
        let isEndExamPaused = false;
        let isSpeaking = false;
        let isPausedTts = false;
        let speechUtterance = null;
        let speechSynthesis = window.speechSynthesis;

        const timerDisplay = document.getElementById('timer');
        const startButton = document.getElementById('start');
        const pauseButton = document.getElementById('pause');
        const resetButton = document.getElementById('reset');
        const setTimerButton = document.getElementById('setTimer');
        const setTimeDisplay = document.getElementById('setTimeDisplay');
        const hoursInput = document.getElementById('hours');
        const minutesInput = document.getElementById('minutes');
        const secondsInput = document.getElementById('seconds');
        const endExamAudio = document.getElementById('endExamAudio');
        const endExamControls = document.getElementById('endExamControls');
        const playEndExamButton = document.getElementById('playEndExam');
        const pauseEndExamButton = document.getElementById('pauseEndExam');
        const stopEndExamButton = document.getElementById('stopEndExam');
        const endExamStatus = document.getElementById('endExamStatus');
        const announcementDiv = document.getElementById('announcement');
        const ttsTextarea = document.getElementById('ttsText');
        const playTtsButton = document.getElementById('playTts');
        const pauseTtsButton = document.getElementById('pauseTts');
        const resumeTtsButton = document.getElementById('resumeTts');
        const stopTtsButton = document.getElementById('stopTts');
        const ttsStatus = document.getElementById('ttsStatus');
        const ttsVoiceSelect = document.getElementById('ttsVoice');
        const ttsRateInput = document.getElementById('ttsRate');
        const ttsPitchInput = document.getElementById('ttsPitch');
        const ttsRateValue = document.getElementById('ttsRateValue');
        const ttsPitchValue = document.getElementById('ttsPitchValue');
        const presetNameInput = document.getElementById('presetName');
        const savePresetButton = document.getElementById('savePreset');
        const presetSelect = document.getElementById('presetSelect');
        const loadPresetButton = document.getElementById('loadPreset');
        const deletePresetButton = document.getElementById('deletePreset');
        const ttsContainer = document.getElementById('ttsContainer');
        const ttsHeader = document.getElementById('ttsHeader');
        const ttsToggle = document.getElementById('ttsToggle');
        const ttsContent = document.getElementById('ttsContent');
        const subjectTitleInput = document.getElementById('subjectTitle');

        // Disable buttons initially
        pauseButton.disabled = true;
        startButton.disabled = true;

        function updateDisplay(timeInSeconds) {
            const hours = Math.floor(timeInSeconds / 3600);
            const minutes = Math.floor((timeInSeconds % 3600) / 60);
            const seconds = timeInSeconds % 60;

            timerDisplay.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

            if (timeInSeconds <= 10) {
                timerDisplay.classList.add('warning');
            } else {
                timerDisplay.classList.remove('warning');
            }
        }

        function setTimer() {
            const hours = parseInt(hoursInput.value) || 0;
            const minutes = parseInt(minutesInput.value) || 0;
            const seconds = parseInt(secondsInput.value) || 0;

            if (hours === 0 && minutes === 0 && seconds === 0) {
                alert('Please set a time duration!');
                return;
            }

            timeLeft = hours * 3600 + minutes * 60 + seconds;
            updateDisplay(timeLeft);

            // Show the set time display
            setTimeDisplay.style.display = 'block';
            setTimeDisplay.textContent = `Ready to start: ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

            // Enable start button
            startButton.disabled = false;
        }

        async function startTimer() {
            if (timerId !== null) return;

            // If time is not set, set it first
            if (timeLeft === undefined || timeLeft === 0) {
                setTimer();
                if (timeLeft === 0) return; // Setting failed
            }

            // Disable inputs and buttons during announcement
            hoursInput.disabled = true;
            minutesInput.disabled = true;
            secondsInput.disabled = true;
            startButton.disabled = true;
            pauseButton.disabled = true;
            resetButton.disabled = true;
            setTimerButton.disabled = true;

            // Hide the set time display
            setTimeDisplay.style.display = 'none';

            // Show announcement
            announcementDiv.style.display = 'block';
            await new Promise(resolve => setTimeout(resolve, 3000));
            announcementDiv.style.display = 'none';

            // Re-enable pause and reset buttons
            pauseButton.disabled = false;
            resetButton.disabled = false;

            isRunning = true;

            timerId = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateDisplay(timeLeft);
                } else {
                    clearInterval(timerId);
                    timerId = null;
                    // Show end exam controls and play audio
                    endExamControls.classList.add('show');
                    playEndExamAudio();
                    alert('Exam time is up!');
                    resetTimer();
                }
            }, 1000);
        }

        function pauseTimer() {
            if (timerId !== null) {
                clearInterval(timerId);
                timerId = null;
                startButton.disabled = false;
                isRunning = false;
            }
        }

        function resetTimer() {
            clearInterval(timerId);
            timerId = null;
            isRunning = false;
            timeLeft = 0;
            updateDisplay(0);

            // Enable inputs and buttons
            hoursInput.disabled = false;
            minutesInput.disabled = false;
            secondsInput.disabled = false;
            startButton.disabled = true;
            setTimerButton.disabled = false;

            // Clear inputs
            hoursInput.value = '';
            minutesInput.value = '';
            secondsInput.value = '';

            // Hide the set time display
            setTimeDisplay.style.display = 'none';

            timerDisplay.classList.remove('warning');
            endExamControls.classList.remove('show');
            stopEndExamAudio();
        }

        function playEndExamAudio() {
            if (isPlayingEndExam && !isEndExamPaused) return;

            if (isEndExamPaused) {
                // Resume playback
                endExamAudio.play().catch(error => {
                    console.log('Audio playback failed:', error);
                    endExamStatus.textContent = "Error playing audio file.";
                    resetEndExamState();
                });
                isEndExamPaused = false;
                endExamStatus.textContent = "Playing end of Assessment announcement...";
            } else {
                // Start new playback
                isPlayingEndExam = true;
                endExamAudio.currentTime = 0;
                endExamAudio.play().catch(error => {
                    console.log('Audio playback failed:', error);
                    endExamStatus.textContent = "Error playing audio file.";
                    resetEndExamState();
                });
                endExamStatus.textContent = "Playing end of Assessment announcement...";
            }

            // Update button states
            playEndExamButton.disabled = true;
            pauseEndExamButton.disabled = false;
            stopEndExamButton.disabled = false;
        }

        function pauseEndExamAudio() {
            if (!isPlayingEndExam || isEndExamPaused) return;

            endExamAudio.pause();
            isEndExamPaused = true;
            playEndExamButton.disabled = false;
            endExamStatus.textContent = "Announcement paused. Click Play to resume.";
        }

        function stopEndExamAudio() {
            endExamAudio.pause();
            endExamAudio.currentTime = 0;
            resetEndExamState();
            endExamStatus.textContent = "Announcement stopped.";
            setTimeout(() => {
                endExamStatus.textContent = "";
                endExamControls.classList.remove('show');
            }, 3000);
        }

        function resetEndExamState() {
            isPlayingEndExam = false;
            isEndExamPaused = false;
            playEndExamButton.disabled = false;
            pauseEndExamButton.disabled = true;
            stopEndExamButton.disabled = true;
        }

        // End exam audio completion handler
        endExamAudio.addEventListener('ended', () => {
            resetEndExamState();
            endExamStatus.textContent = "End of Assessment announcement completed.";
            setTimeout(() => {
                endExamStatus.textContent = "";
                endExamControls.classList.remove('show');
            }, 3000);
        });

        // Initialize button states
        pauseEndExamButton.disabled = true;
        stopEndExamButton.disabled = true;
        pauseTtsButton.disabled = true;
        resumeTtsButton.disabled = true;
        stopTtsButton.disabled = true;

        // Add event listeners for audio control buttons
        playEndExamButton.addEventListener('click', playEndExamAudio);
        pauseEndExamButton.addEventListener('click', pauseEndExamAudio);
        stopEndExamButton.addEventListener('click', stopEndExamAudio);

        // Add event listeners for TTS control buttons
        playTtsButton.addEventListener('click', playTts);
        pauseTtsButton.addEventListener('click', pauseTts);
        resumeTtsButton.addEventListener('click', resumeTts);
        stopTtsButton.addEventListener('click', stopTts);

        // Add event listeners for preset buttons
        savePresetButton.addEventListener('click', savePreset);
        loadPresetButton.addEventListener('click', loadPreset);
        deletePresetButton.addEventListener('click', deletePreset);

        // Initialize preset dropdown
        updatePresetDropdown();

        // Text-to-Speech functions
        function playTts() {
            const text = ttsTextarea.value.trim();
            if (!text) {
                alert('Please enter text to be read aloud.');
                return;
            }

            if (isSpeaking && !isPausedTts) return;

            if (isPausedTts) {
                // Resume speech
                speechSynthesis.resume();
                isPausedTts = false;
                ttsStatus.textContent = "Speaking...";
                playTtsButton.disabled = true;
                resumeTtsButton.disabled = true;
                pauseTtsButton.disabled = false;
            } else {
                // Start new speech
                speechUtterance = new SpeechSynthesisUtterance(text);

                // Set voice to selected voice
                const selectedVoiceName = ttsVoiceSelect.value;
                const voices = speechSynthesis.getVoices();
                const selectedVoice = voices.find(voice => voice.name === selectedVoiceName);

                if (selectedVoice) {
                    speechUtterance.voice = selectedVoice;
                } else {
                    console.warn('Selected voice not found, using default');
                }

                speechUtterance.rate = parseFloat(ttsRateInput.value);
                speechUtterance.pitch = parseFloat(ttsPitchInput.value);

                speechUtterance.onstart = () => {
                    isSpeaking = true;
                    ttsStatus.textContent = "Speaking...";
                    playTtsButton.disabled = true;
                    resumeTtsButton.disabled = true;
                    pauseTtsButton.disabled = false;
                    stopTtsButton.disabled = false;
                };

                speechUtterance.onend = () => {
                    resetTtsState();
                    ttsStatus.textContent = "Finished speaking.";
                    setTimeout(() => {
                        ttsStatus.textContent = "";
                    }, 3000);
                };

                speechUtterance.onerror = (event) => {
                    console.error('Speech synthesis error:', event);
                    ttsStatus.textContent = "Error occurred while speaking.";
                    resetTtsState();
                };

                // Start speaking
                speechSynthesis.speak(speechUtterance);
            }
        }

        function pauseTts() {
            if (!isSpeaking || isPausedTts) return;

            speechSynthesis.pause();
            isPausedTts = true;
            ttsStatus.textContent = "Paused. Click Resume to continue.";
            pauseTtsButton.disabled = true;
            resumeTtsButton.disabled = false;
        }

        function resumeTts() {
            if (!isSpeaking || !isPausedTts) return;

            speechSynthesis.resume();
            isPausedTts = false;
            ttsStatus.textContent = "Speaking...";
            pauseTtsButton.disabled = false;
            resumeTtsButton.disabled = true;
        }

        function stopTts() {
            speechSynthesis.cancel();
            resetTtsState();
            ttsStatus.textContent = "Stopped speaking.";
            setTimeout(() => {
                ttsStatus.textContent = "";
            }, 3000);
        }

        function resetTtsState() {
            isSpeaking = false;
            isPausedTts = false;
            playTtsButton.disabled = false;
            pauseTtsButton.disabled = true;
            resumeTtsButton.disabled = true;
            stopTtsButton.disabled = true;
        }

        // TTS preset functions
        function savePreset() {
            const presetName = presetNameInput.value.trim();
            if (!presetName) {
                alert('Please enter a name for this preset.');
                return;
            }

            const presetData = {
                text: ttsTextarea.value,
                rate: ttsRateInput.value,
                pitch: ttsPitchInput.value
                // Voice selection removed as it's fixed
            };

            // Get existing presets or initialize empty object
            const existingPresets = JSON.parse(localStorage.getItem('ttsPresets') || '{}');

            // Add/update preset
            existingPresets[presetName] = presetData;

            // Save back to localStorage
            localStorage.setItem('ttsPresets', JSON.stringify(existingPresets));

            // Update preset dropdown
            updatePresetDropdown();

            // Clear preset name input
            presetNameInput.value = '';

            ttsStatus.textContent = `Preset "${presetName}" saved.`;
            setTimeout(() => {
                ttsStatus.textContent = '';
            }, 3000);
        }

        function loadPreset() {
            const selectedPreset = presetSelect.value;
            if (!selectedPreset) {
                alert('Please select a preset to load.');
                return;
            }

            // Load presets from localStorage
            const presets = JSON.parse(localStorage.getItem('ttsPresets') || '{}');

            if (presets[selectedPreset]) {
                const preset = presets[selectedPreset];

                // Apply preset values
                ttsTextarea.value = preset.text || '';
                ttsRateInput.value = preset.rate || 1;
                ttsPitchInput.value = preset.pitch || 1;

                // Update display values
                ttsRateValue.textContent = parseFloat(ttsRateInput.value).toFixed(1);
                ttsPitchValue.textContent = parseFloat(ttsPitchInput.value).toFixed(1);

                ttsStatus.textContent = `Preset "${selectedPreset}" loaded.`;
                setTimeout(() => {
                    ttsStatus.textContent = '';
                }, 3000);
            } else {
                alert('Preset not found.');
            }
        }

        function deletePreset() {
            const selectedPreset = presetSelect.value;
            if (!selectedPreset) {
                alert('Please select a preset to delete.');
                return;
            }

            // Load presets from localStorage
            const presets = JSON.parse(localStorage.getItem('ttsPresets') || '{}');

            if (presets[selectedPreset]) {
                // Confirm deletion
                if (confirm(`Are you sure you want to delete preset "${selectedPreset}"?`)) {
                    // Delete preset
                    delete presets[selectedPreset];

                    // Save back to localStorage
                    localStorage.setItem('ttsPresets', JSON.stringify(presets));

                    // Update preset dropdown
                    updatePresetDropdown();

                    ttsStatus.textContent = `Preset "${selectedPreset}" deleted.`;
                    setTimeout(() => {
                        ttsStatus.textContent = '';
                    }, 3000);
                }
            } else {
                alert('Preset not found.');
            }
        }

        function updatePresetDropdown() {
            // Clear existing options except the default one
            while (presetSelect.options.length > 1) {
                presetSelect.remove(1);
            }

            // Load presets from localStorage
            const presets = JSON.parse(localStorage.getItem('ttsPresets') || '{}');

            // Add presets to dropdown
            for (const presetName in presets) {
                const option = document.createElement('option');
                option.value = presetName;
                option.textContent = presetName;
                presetSelect.appendChild(option);
            }
        }

        // Initialize TTS voice options
        function populateVoiceList() {
            const voices = speechSynthesis.getVoices();
            ttsVoiceSelect.innerHTML = '';

            // Filter for English and Traditional Chinese voices
            let relevantVoices = voices.filter(voice =>
                voice.lang.startsWith('en') ||
                voice.lang === 'zh-TW' ||
                voice.lang === 'zh-HK'
            );

            // Sort voices: Natural/Online first
            relevantVoices.sort((a, b) => {
                const aName = a.name.toLowerCase();
                const bName = b.name.toLowerCase();
                const aIsNatural = aName.includes('natural') || aName.includes('online');
                const bIsNatural = bName.includes('natural') || bName.includes('online');

                if (aIsNatural && !bIsNatural) return -1;
                if (!aIsNatural && bIsNatural) return 1;
                return aName.localeCompare(bName);
            });

            // Add voices to the dropdown
            relevantVoices.forEach(voice => {
                const option = document.createElement('option');
                const isNatural = voice.name.toLowerCase().includes('natural') || voice.name.toLowerCase().includes('online');
                option.textContent = `${isNatural ? 'ðŸŒŸ ' : ''}${voice.name} (${voice.lang})`;
                option.value = voice.name;
                ttsVoiceSelect.appendChild(option);
            });

            // Try to select Microsoft Andrew as default if available, otherwise first available
            const andrewVoice = relevantVoices.find(voice =>
                voice.name.includes('Microsoft Andrew') &&
                voice.name.includes('Natural') &&
                voice.lang === 'en-US'
            );

            if (andrewVoice) {
                ttsVoiceSelect.value = andrewVoice.name;
            }
        }

        // Handle voice list changes
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = populateVoiceList;
        }

        // Initial population attempt
        populateVoiceList();

        // Update rate and pitch display values
        ttsRateInput.addEventListener('input', () => {
            ttsRateValue.textContent = parseFloat(ttsRateInput.value).toFixed(1);
        });

        ttsPitchInput.addEventListener('input', () => {
            ttsPitchValue.textContent = parseFloat(ttsPitchInput.value).toFixed(1);
        });

        // Toggle TTS container minimize/expand
        ttsHeader.addEventListener('click', () => {
            ttsContainer.classList.toggle('minimized');
            ttsToggle.textContent = ttsContainer.classList.contains('minimized') ? '+' : 'âˆ’';
        });

        startButton.addEventListener('click', startTimer);
        pauseButton.addEventListener('click', pauseTimer);
        resetButton.addEventListener('click', resetTimer);
        setTimerButton.addEventListener('click', setTimer);

        // Input validation
        function validateInput(input, max) {
            input.addEventListener('input', () => {
                let value = parseInt(input.value);
                if (isNaN(value)) {
                    input.value = '';
                } else if (value < 0) {
                    input.value = '0';
                } else if (value > max) {
                    input.value = max;
                }
            });
        }

        validateInput(hoursInput, 23);
        validateInput(minutesInput, 59);
        validateInput(secondsInput, 59);

        // Add event listeners for time adjustment buttons
        document.getElementById('addHour').addEventListener('click', () => adjustTime('hours', 1));
        document.getElementById('subtractHour').addEventListener('click', () => adjustTime('hours', -1));
        document.getElementById('addMinute').addEventListener('click', () => adjustTime('minutes', 1));
        document.getElementById('subtractMinute').addEventListener('click', () => adjustTime('minutes', -1));
        document.getElementById('addSecond').addEventListener('click', () => adjustTime('seconds', 1));
        document.getElementById('subtractSecond').addEventListener('click', () => adjustTime('seconds', -1));

        function adjustTime(unit, amount) {
            const input = document.getElementById(unit);
            let value = parseInt(input.value) || 0;
            const max = unit === 'hours' ? 23 : 59;

            value += amount;

            // Handle overflow/underflow
            if (value > max) {
                if (unit === 'minutes') {
                    const hoursInput = document.getElementById('hours');
                    const hours = parseInt(hoursInput.value) || 0;
                    hoursInput.value = hours + 1;
                    value = 0;
                } else if (unit === 'seconds') {
                    const minutesInput = document.getElementById('minutes');
                    const minutes = parseInt(minutesInput.value) || 0;
                    minutesInput.value = minutes + 1;
                    value = 0;
                } else {
                    value = max;
                }
            } else if (value < 0) {
                if (unit === 'minutes') {
                    const hoursInput = document.getElementById('hours');
                    const hours = parseInt(hoursInput.value) || 0;
                    if (hours > 0) {
                        hoursInput.value = hours - 1;
                        value = 59;
                    } else {
                        value = 0;
                    }
                } else if (unit === 'seconds') {
                    const minutesInput = document.getElementById('minutes');
                    const minutes = parseInt(minutesInput.value) || 0;
                    if (minutes > 0) {
                        minutesInput.value = minutes - 1;
                        value = 59;
                    } else {
                        value = 0;
                    }
                } else {
                    value = 0;
                }
            }

            input.value = value;
        }

        // Full screen mode functionality
        const fullscreenButton = document.getElementById('fullscreenButton');
        let fullscreenMode = false;
        let fullscreenContainer = null;
        let exitFullscreenButton = null;
        let fullscreenLogo = null;
        let fullscreenTimer = null;

        fullscreenButton.addEventListener('click', toggleFullscreen);

        function toggleFullscreen() {
            if (!fullscreenMode) {
                enterFullscreen();
            } else {
                exitFullscreen();
            }
        }

        function enterFullscreen() {
            // Create fullscreen container
            fullscreenContainer = document.createElement('div');
            fullscreenContainer.className = 'fullscreen-mode';

            // Create no mobile phone icon
            const noMobileIcon = document.createElement('img');
            noMobileIcon.src = 'no_electdevices.jpg';
            noMobileIcon.alt = 'No Mobile Phones';
            noMobileIcon.className = 'no-mobile-icon';

            // Get subject title
            const subjectTitle = subjectTitleInput.value.trim() || "Assessment";

            // Create subject title display
            const subjectTitleDisplay = document.createElement('div');
            subjectTitleDisplay.className = 'subject-title-display';
            subjectTitleDisplay.id = 'fullscreenSubjectTitle';
            subjectTitleDisplay.textContent = subjectTitle;

            // Clone logo and timer for fullscreen mode
            fullscreenLogo = document.querySelector('.logo-container').cloneNode(true);
            fullscreenTimer = document.createElement('div');
            fullscreenTimer.className = 'timer-display';
            fullscreenTimer.id = 'fullscreenTimer';
            fullscreenTimer.textContent = timerDisplay.textContent;

            // Create start exam button for fullscreen mode
            const fullscreenStartButton = document.createElement('button');
            fullscreenStartButton.className = 'fullscreen-btn';
            fullscreenStartButton.id = 'fullscreenStartButton';
            fullscreenStartButton.textContent = 'Start Exam';
            fullscreenStartButton.disabled = !startButton || startButton.disabled;
            fullscreenStartButton.addEventListener('click', () => {
                startTimer();
                fullscreenStartButton.style.display = 'none';
            });

            // Create exit button
            exitFullscreenButton = document.createElement('button');
            exitFullscreenButton.className = 'exit-fullscreen';
            exitFullscreenButton.innerHTML = 'âœ•';
            exitFullscreenButton.title = 'Exit full screen mode';
            exitFullscreenButton.addEventListener('click', exitFullscreen);

            // Create a wrapper for better layout
            const contentWrapper = document.createElement('div');
            contentWrapper.style.display = 'flex';
            contentWrapper.style.flexDirection = 'column';
            contentWrapper.style.alignItems = 'center';
            contentWrapper.style.justifyContent = 'center';
            contentWrapper.style.gap = '2rem';
            contentWrapper.style.height = '100%';

            // Append elements to content wrapper
            contentWrapper.appendChild(fullscreenLogo);
            contentWrapper.appendChild(subjectTitleDisplay);
            contentWrapper.appendChild(fullscreenTimer);
            contentWrapper.appendChild(fullscreenStartButton);

            // Append wrapper and exit button to fullscreen container
            fullscreenContainer.appendChild(noMobileIcon);
            fullscreenContainer.appendChild(exitFullscreenButton);
            fullscreenContainer.appendChild(contentWrapper);

            // Add to body
            document.body.appendChild(fullscreenContainer);

            // Update flag
            fullscreenMode = true;

            // Hide fullscreen button
            fullscreenButton.style.display = 'none';
        }

        function exitFullscreen() {
            if (fullscreenContainer) {
                document.body.removeChild(fullscreenContainer);
                fullscreenContainer = null;
            }

            fullscreenMode = false;
            fullscreenButton.style.display = 'flex';
        }

        // Update fullscreen timer when main timer changes
        const originalUpdateDisplay = updateDisplay;
        updateDisplay = function (timeInSeconds) {
            originalUpdateDisplay(timeInSeconds);

            // Also update fullscreen timer if it exists
            if (fullscreenMode && document.getElementById('fullscreenTimer')) {
                document.getElementById('fullscreenTimer').textContent = timerDisplay.textContent;

                // Apply warning class if needed
                if (timeInSeconds <= 10) {
                    document.getElementById('fullscreenTimer').classList.add('warning');
                } else {
                    document.getElementById('fullscreenTimer').classList.remove('warning');
                }

                // Hide start button if timer is running
                const fullscreenStartButton = document.getElementById('fullscreenStartButton');
                if (fullscreenStartButton && isRunning) {
                    fullscreenStartButton.style.display = 'none';
                }
            }
        };

        // Update the fullscreen start button state when the normal start button state changes
        const originalSetTimer = setTimer;
        setTimer = function () {
            originalSetTimer();

            // Update fullscreen start button if it exists
            if (fullscreenMode && document.getElementById('fullscreenStartButton')) {
                document.getElementById('fullscreenStartButton').disabled = false;
            }
        };
    </script>
</body>

</html>
